---
title: "A Bayesian Latent Variable Model for Semi-parametric Identification and Analysis of COVID-19 Infection Rates"
subtitle: Presentation for the University of Virginia
date: last-modified
date-format: long
incremental: true
format:
  revealjs: 
    theme: [moon,customtext.css]
    embed-resources: true
author: 
  - name: Robert Kubinec
    affiliation: New York University Abu Dhabi
    corresponding: true
  - name: Luiz Max Carvalho
    affiliation: Getúlio Vargas Foundation
  - name: Joan Barceló
    affiliation: New York University Abu Dhabi
  - name: Cindy Cheng
    affiliation: Technical University of Munich
  - name: Luca Messerschmidt
    affiliation: Technical University of Munich
indent: true
editor: visual
bibliography: BibTexDatabase.bib
---

```{r setup, include=FALSE}

library(tidyverse)
library(ggplot2)

```

## What Does It Take to Be Prepared for a Pandemic?

-   Even countries with the highest pandemic preparedness fell woefully short in their ability to contain it.

-   No one discipline can solve all aspects of a pandemic.

    -   Epidemiology: wealth of knowledge of disease transmission mechanisms.

    -   Social science: excellent models of human behavior & data.

## Research Question

> How can we robustly model infections in the early pandemic period in order to analyze the role of important covariates via theoretically-informed mechanisms?

Our contribution: a model with robust estimates of viral infections *and* nuanced modeling of human decision-making.

## The (In)Famous March 2020 Imperial College Report

::: r-stack
![](images/Screen%20Shot%202023-12-22%20at%202.52.30%20PM.png){.fragment fig-align="center" width="900"}

![](images/Screen%20Shot%202023-12-31%20at%202.12.45%20PM.png){.fragment fig-align="center"}
:::

## When The Trends Aren't Parallel But the Trends Are Good

::: r-stack
![](images/Screen%20Shot%202023-12-30%20at%2011.58.35%20AM.png){.fragment .absolute width="700" top="170" right="0"}

![](images/Screen%20Shot%202023-12-30%20at%2011.36.03%20AM.png){.fragment .absolute width="700" top="170" right="450"}

![](images/Screen%20Shot%202023-12-30%20at%2011.27.05%20AM.png){.fragment fig-align="center"}
:::

# Model Definition

## The Model as a Causal Graph

For each state $c$ and day $t$,

::: r-stack
![](images/baseline_dag.png){.fragment fig-align="center"}

![](images/baseline_dag2.png){.fragment fig-align="center"}

![](images/baseline_dag3.png){.fragment fig-align="center"}
:::

## Adding in Causal Pathways

We can add in mediators fear of the virus $F_{ct}$ and mobility $M_{ct}$.

::: r-stack
![](images/mediator_dag1.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag2.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag3.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag4.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag5.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag6.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag7.png){.fragment .absolute width="800" top="200" right="100"} ![](images/mediator_dag8.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag9.png){.fragment .absolute width="800" top="200" right="100"}

![](images/mediator_dag10.png){.fragment .absolute width="800" top="200" right="100"}
:::

## Model Estimation

1.  Define $I_{ct}$ as a latent random variable with $X_{ct}$ as an exogenous predictor.
2.  Model $I_{ct}$ $\rightarrow$ $a_{ct}$ and $I_{ct}$ $\rightarrow q_{ct}$ as two Beta-Binomial distributions with $I_{ct}$ as a predictor.
3.  Model $X_{ct} \rightarrow F_{ct}$ as a Normally-distributed linear specification (OLS).
4.  Model $X_{ct} \rightarrow M_{ct}$ as Multivariate-Normally-distributed linear specifications with correlated errors.
5.  Sample (1) - (4) jointly with priors using Hamiltonian Monte Carlo with Stan to obtain posterior distributions.

## Model Assumptions

1.  Infections $I_{ct}$ are weakly increasing (they cannot decrease).
2.  Counterfactual infections $I_{ct}$ can be represented by a 3-order polynomial time trend (re: SIR/SEIR models).
3.  At least some prior information $P(I_{ct})$ exists.
4.  Weakly informative priors on other parameters ($\theta$) centered at 0.

## Data {.smaller}

-   State-day dataset from March 10th to July 14th of 2020 with counts of cases (positive tests) and total number of tests.

-   Counts of BLM-related protests derived from news media aggregators.

-   Daily polling averages of % reporting strong fear of the virus (Facebook COVID-19 Trends and Impact Survey).

-   Daily Google mobility data for cellphone-based activity in six domains (retail, workplaces, parks, transit, residences, and restaurants).

-   Daily Facebook polling average of % concerns over economic uncertainty.

-   Cross-sectional poll of masking prevalence from May of 2020.

-   All time-varying covariates lagged 14 days (time of infection -\> reported cases).

## A Good Prior Is Hard to Find {.r-fit-text}

-   Two primary sources:

    -   Serological surveys implemented by the CDC

    -   Survey of experts (epidemiologists) about infections in the US [@mcandrew2022].

    -   We stratify this survey to the state level via case/test ratios.

## Comparison to Other Methods

![](est_vs_obs_experts.png){fig-align="center"}

# Results

## Association of Mobility Indices with Infections

![](images/Screen%20Shot%202023-12-29%20at%209.31.07%20AM.png){fig-align="center"}

## Residual Correlation of Mobility Indices

![](images/Screen%20Shot%202023-12-29%20at%209.30.15%20AM.png){fig-align="center"}

## Payoff: Theoretically-Informed Associations

::: r-stack
![](images/covariate_plot1_1.jpg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_2.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_3.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_4.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_5.png){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_6.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_7.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_8.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_9.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_10.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_11.jpeg){.fragment .absolute width="750" top="85" right="200"} ![](images/covariate_plot1_12.jpeg){.fragment .absolute width="750" top="85" right="200"}

![](images/covariate_plot1_13.jpeg){.fragment .absolute width="750" top="85" right="200"}
:::

# Future Research and the Contagion Program

## CoronaNet: Robust Measurement of Government Efforts {.r-fit-text}

-   CoronaNet is a database of over 100,000 manually coded policy records with original sources (PDFs).

    -   Openly available and cited in over 400 studies to date.

-   Our five policy intensity scores are under review (*R&R* at the Journal of Politics).

-   We continue to ingest data from defunct policy projects.

-   This project's new home will be the University of Virginia.

## Future Questions for Exploration {.r-fit-text}

-   We want to more directly test for the effect of COVID-19 policies on outcomes.

    -   Need to grapple with partial causal identification & sensitivity analysis.

    -   Need to account for missing data in the tests/case distributions.

-   Explore the effects of policies on vulnerable groups.

    -   Wide variability in the exceptions and specific targeting of COVID-19 policies.

# Modeling Validation

## Effect of Informative Priors

![](images/Screen%20Shot%202023-12-26%20at%2011.51.03%20AM.png){fig-align="center"}

## Good Priors + Informative Covariates = Learning

![](images/Screen%20Shot%202023-12-26%20at%2011.58.33%20AM.png){fig-align="center"}

## COVID-19 Policy Counts

![](images/Screen%20Shot%202023-12-29%20at%209.39.15%20AM.png){fig-align="center"}

## Convergence Checks

![](images/Screen%20Shot%202023-12-29%20at%209.38.45%20AM.png){fig-align="center"}

## Posterior Predictive Checks

![](images/Screen%20Shot%202023-12-29%20at%209.38.09%20AM.png){fig-align="center"}

## State-level Infection Trends and Priors

![](images/Screen%20Shot%202023-12-29%20at%209.37.27%20AM.png){fig-align="center"}

## Number Tested Relative to Total Infections

![](images/Screen%20Shot%202023-12-29%20at%209.36.43%20AM.png){fig-align="center"}

## Association of Time-Varying Trump Approval with Infections

![](images/Screen%20Shot%202023-12-29%20at%209.32.26%20AM.png){fig-align="center"}

# Mathematical Derivation

## Bayes to the Rescue {.r-fit-text}

Given a set of:

1.  Latent infections $I$,
2.  Data $X$ and regression parameters $\theta$,

Infer an estimate of infections $P(I|X;\theta)$ that incorporates all available information:

$$
\begin{equation}\begin{aligned}\underbrace{P(I|X; \theta)}_{\text{Posterior}} &= \frac{\underbrace{P(X; \theta|I)}_{\text{Likelihood}} \cdot \underbrace{P(I)P(\theta)}_{\text{Prior}}}{\underbrace{P(X; \theta)}_{\text{Evidence}}}\end{aligned}\end{equation}
$$

## Define Infections as a Latent Variable $I$

We can model infections $I_{ct}$ for each state $c$ and day $t$ as a Beta-distributed random variable with a mean $\mu$ as a function of covariates and polynomial time trend along with a dispersion parameter $\phi$:

$$
\begin{align}
\operatorname{Pr}(I_{ct} \mid t=T) &\sim \operatorname{Beta}(\mu \phi, (1 - \mu)\phi)\\
        \mu = & g^{-1}(\alpha_1 + \beta_{I1}t_o + \beta_{I2}t_o^2 + \beta_{I3}t_o^3 +
                        \beta_C X_{ct})
\end{align}
$$

## Model Total Number of Daily Tests as a Function of Infections

We can model daily tests $q_{ct}$ as a Binomial random variable with a quadratic time trend (marginally decreasing returns to test production capacity) and infections as a latent variable.

$$
\begin{equation}
q_{ct} \sim \operatorname{Binomial}(c_{p}, g^{-1}(\alpha_2 + \beta_b I_{ct} + 
\beta_{cq1}L_t + \beta_{cq2} L_t^2)).
\end{equation}
$$

## Model Positive Tests (Cases) As a Function of Infections

We can model daily positive cases $a_{ct}$ as a Binomial random variable that is likewise a function of infections $I_{ct}$ with a scaling parameter $\beta_a$:

$$
\begin{equation}
a_{ct} \sim \operatorname{Binomial}(c_p, g^{-1}(\alpha_3 + \beta_a I_{ct}))
\end{equation} 
$$

## Combine Into a Beta-Binomial Model

To improve sampling, implicitly define $I_{ct}$ as Beta-distributed by using the compound Beta-Binomial distribution with tests/cases as the outcome:

$$
\begin{align}
q_{ct} & \sim \operatorname{Beta-Binomial}(c_p, \mu_q \phi_q, (1-\mu_q) \phi_q)\\
\mu_q &= g^{-1}(\alpha_2 + \beta_b I_{ct} + 
\beta_{cq1}L_t + \beta_{cq2}L_t^2)
\end{align}
$$ $$
\begin{align}
a_{ct} &\sim \operatorname{Beta-Binomial}(q_{ct}, \mu_a \phi_a, (1 - \mu_a) \phi_a) \\
\mu_a &= g^{-1}(\alpha_3 + \beta_a I_{ct}).
\end{align}
$$

## Impose Ordered Constraint on Infections $I_{ct}$

Absent additional information, $I_{ct}$ is not identified because it is a parameter, not data.

$$
\begin{equation}
I_{ct} = \begin{cases}
          I_{ct} & \text{if } t=1\\
          I_{ct-1} + e^{I_{ct}} &  \text{if } 1 < t < T
        \end{cases}
\end{equation}
$$

## Add In Informative Prior Information

To further identify the scale and location of $I_{ct}$, we can add in additional information about infections from serology surveys $S_{ct}$ and expert surveys $E_{ct}$ that incorporate uncertainty in these estimates:

$$
\begin{align}
S_{ct} &\sim \operatorname{Binomial}(S^N_{ct},g^{-1}(I_{ct}))\\
E_{ct} &\sim \operatorname{Beta}(S^N_{ct},g^{-1}(I_{ct})\phi_E,(1-g^{-1}(I_{ct}))\phi_E ))
\end{align}
$$

## Other Weakly Informative Priors {.scrollable}

We add in zero-centered weak priors on other parameters/intercepts/regression coefficients:

$$
\begin{align}
\beta_a &\sim \operatorname{Normal}(0,5),\\
\beta_{qci} &\sim \operatorname{Normal}(\mu_{qi},\sigma_{qi}),\\
\sigma_{qi} &\sim \operatorname{Exponential}(100),\\
\mu_{qi} &\sim \operatorname{Normal}(0, 50),\\
\beta_{C} &\sim \operatorname{Normal}(0, 5),\\
\beta_{Ii} &\sim \operatorname{Normal}(0, 50),\\
\alpha_1 &\sim \operatorname{Normal} (0,10),\\
\alpha_2 &\sim \operatorname{Normal}(0,10),\\
\alpha_3 &\sim \operatorname{Normal}(0,10)
\end{align} 
$$

## Incorporate Mediators: Fear and Mobility

We include our daily measures of mobility $M_{ct}$ and fear of the virus $F_{ct}$ as additional likelihoods to allow for indirect causal pathways through covariates $X_{ct}$ to $I_{ct}$. Mobility is modeled using a multivariate Normal distribution to allow for correlation between mobility types.

$$
\begin{align}
M_{ct} &\sim MVN(\alpha_m + \beta_m X'_{ct},\Sigma_m)\\
F_{ct} &\sim N(\alpha_f + \beta_f X'_{ct}, \sigma_f)
\end{align}
$$

# Background Information

## CDC Serology Survey Data {.scrollable}

```{r sero_data}

serology <- readRDS("serology.rds")

serology %>% 
  mutate(`% Infected`=paste0(round(inf_pr*100,2),"%")) %>% 
  select(State="state_id",
         `% Infected`,
         N="survey_size",
         `Date Started`="date_begin",
         `Date Ended`="date_end") %>% 
  gt::gt()

```

# Additional Slides

## When Is It Reasonable to Circumvent Lockdown Policies?

![](images/download%20(8).jpeg){fig-align="center"}

## The Challenges of Studying Emergent Events

-   A pandemic with a novel & highly transmissible pathogen proved more than our academic, government and social institutions were able to handle.

    -   We lacked the physical infrastructure to track SARS-CoV-2 by testing [@mercer2021; @griffith2020].

    -   Governing institutions were under severe strain due to polarization [@gadarian2022].

    -   Even countries with high pandemic preparedness fell woefully short.

## Split Opinion About the Role of Floyd in Early COVID Spread {.smaller}

1.  Higher 30-day pre/post growth trends in cities with Floyd protests vs. those without [@valentine2020].

2.  Matching methods with "control" counties within-state: very small increase [@neyman2020].

3.  Difference-in-difference of 208 counties found no relationship; offsetting behaviors reduced infections (fear of violence) [@dave].

4.  No relationship between protests and hospitalizations in California counties [@bui2021].

5.  Found high mask usage among protests & higher COVID-19 incidence in only 1 city (Miami) [@quigley2023].

6.  BLM protests did increase cases but only big protests can have a significant impact [@hong].

## Approach: Making the Best Use of What We Have

![](images/_80286848_capfacebookn.jpeg){fig-align="center"}

## Class Determines Who Is Allowed to Disobey

![](images/download%20(9).jpeg){fig-align="center"}

## References {.scrollable}
